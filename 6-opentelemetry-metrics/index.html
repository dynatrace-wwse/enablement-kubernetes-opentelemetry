
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../5-opentelemetry-traces/">
      
      
        <link rel="next" href="../7-opentelemetry-capstone/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>6. OpenTelemetry Metrics - Dynatrace Enablement Lab: Kubernetes OpenTelemetry</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  
      
    
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/1612cf70810/bf81393wlb/ad7b68fd2b9d9448_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#opentelemetry-metrics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Enablement Lab: Kubernetes OpenTelemetry" class="md-header__button md-logo" aria-label="Dynatrace Enablement Lab: Kubernetes OpenTelemetry" data-md-component="logo">
      
  <img src="https://cdn.bfldr.com/B686QPH3/at/w5hnjzb32k5wcrcxnwcx4ckg/Dynatrace_signet_RGB_HTML.svg?auto=webp&format=pngg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Enablement Lab: Kubernetes OpenTelemetry
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6. OpenTelemetry Metrics
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Enablement Lab: Kubernetes OpenTelemetry" class="md-nav__button md-logo" aria-label="Dynatrace Enablement Lab: Kubernetes OpenTelemetry" data-md-component="logo">
      
  <img src="https://cdn.bfldr.com/B686QPH3/at/w5hnjzb32k5wcrcxnwcx4ckg/Dynatrace_signet_RGB_HTML.svg?auto=webp&format=pngg" alt="logo">

    </a>
    Dynatrace Enablement Lab: Kubernetes OpenTelemetry
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-codespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Codespaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-opentelemetry-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. OpenTelemetry Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-opentelemetry-traces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. OpenTelemetry Traces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    6. OpenTelemetry Metrics
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    6. OpenTelemetry Metrics
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collector-for-node-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Collector for Node Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collector for Node Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-opentelemetry-collector" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy OpenTelemetry Collector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-kubernetes-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Kubernetes RBAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeletstats-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      kubeletstats receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8sattributes-processor" class="md-nav__link">
    <span class="md-ellipsis">
      k8sattributes Processor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collector-for-cluster-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Collector for Cluster Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collector for Cluster Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-opentelemetry-collector_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy OpenTelemetry Collector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8s_cluster-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      k8s_cluster receiver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#export-application-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Export Application Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Export Application Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#otlp-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      otlp receiver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Wrap Up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-you-learned-today" class="md-nav__link">
    <span class="md-ellipsis">
      What You Learned Today
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-opentelemetry-capstone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. OpenTelemetry Capstone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Cleanup
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collector-for-node-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Collector for Node Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collector for Node Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-opentelemetry-collector" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy OpenTelemetry Collector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-kubernetes-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Kubernetes RBAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubeletstats-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      kubeletstats receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8sattributes-processor" class="md-nav__link">
    <span class="md-ellipsis">
      k8sattributes Processor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#collector-for-cluster-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Collector for Cluster Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Collector for Cluster Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-opentelemetry-collector_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy OpenTelemetry Collector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8s_cluster-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      k8s_cluster receiver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#export-application-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Export Application Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Export Application Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#otlp-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      otlp receiver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Wrap Up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-you-learned-today" class="md-nav__link">
    <span class="md-ellipsis">
      What You Learned Today
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<script>
document.addEventListener('DOMContentLoaded', function() {
  dynatrace.sendBizEvent('page_load', {"page": "6. OpenTelemetry Metrics"})
});
</script>
<h1 id="opentelemetry-metrics">OpenTelemetry Metrics<a class="headerlink" href="#opentelemetry-metrics" title="Permanent link">#</a></h1>
<p>In this lab module we'll utilize the OpenTelemetry Collector deployed as a DaemonSet (Node Agent) to collect Node (kubelet) metrics from a Kubernetes cluster and ship them to Dynatrace.  Additionally, we'll utilize a second OpenTelemetry Collector deployed as a Deployment (Gateway) to collect Cluster (Kubernetes API) metrics from the Kubernetes cluster and ship them to Dynatrace.</p>
<p><strong>Lab tasks:</strong></p>
<ol>
<li>Deploy OpenTelemetry Collector as a DaemonSet</li>
<li>Configure OpenTelemetry Collector service pipeline for metric enrichment</li>
<li>Deploy OpenTelemetry Collector as a Deployment</li>
<li>Configure OpenTelemetry Collector service pipeline for metric enrichment</li>
<li>Query and visualize metrics in Dynatrace using DQL</li>
</ol>
<div class="grid cards">
<ul>
<li><a href="https://docs.dynatrace.com/docs/ingest-from/opentelemetry" target="_blank">Learn More<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h2>
<p><strong>Import Notebook into Dynatrace</strong></p>
<p><a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry/blob/main/assets/dynatrace/notebooks/opentelemetry-metrics_dt_notebook.json" target="_blank">Notebook</a></p>
<p><strong>Define workshop user variables</strong></p>
<p>In your Github Codespaces Terminal set the environment variables:</p>
<div class="admonition tip">
<p class="admonition-title">Sprint Environment</p>
<p>Are you using a Sprint environment for your Dynatrace tenant?  If so, then use <code>export DT_ENDPOINT=https://{your-environment-id}.sprint.dynatracelabs.com/api/v2/otlp</code> instead of the <code>live</code> version below.</p>
</div>
<div class="highlight"><pre><span></span><code>export DT_ENDPOINT=https://{your-environment-id}.live.dynatrace.com/api/v2/otlp
export DT_API_TOKEN={your-api-token}
export NAME=&lt;INITIALS&gt;-k8s-otel-o11y
</code></pre></div>
<p><strong>Move into the metrics module directory</strong></p>
<p>Command:
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_DIR</span>/lab-modules/opentelemetry-metrics
</code></pre></div></p>
<h2 id="collector-for-node-metrics">Collector for Node Metrics<a class="headerlink" href="#collector-for-node-metrics" title="Permanent link">#</a></h2>
<p><strong>Kubernetes Node Metrics</strong></p>
<p>Each Kubernetes Node runs a kubelet that includes an API server. The <code>kubeletstats</code> Receiver connects to that kubelet via the API server to collect metrics about the node and the workloads running on the node.</p>
<h3 id="deploy-opentelemetry-collector">Deploy OpenTelemetry Collector<a class="headerlink" href="#deploy-opentelemetry-collector" title="Permanent link">#</a></h3>
<p><strong>Dynatrace Distro - Daemonset (Node Agent)</strong></p>
<p><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opentelemetry.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenTelemetryCollector</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-metrics-node</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-otelcol-dt-api-credentials</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K8S_NODE_NAME</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">        </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.nodeName</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;daemonset&quot;</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ghcr.io/dynatrace/dynatrace-otel-collector/dynatrace-otel-collector:latest&quot;</span>
</code></pre></div>
Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/metrics/otel-collector-metrics-node-crd-01.yaml
</code></pre></div>
Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-metrics-node created</p>
</blockquote>
<p><strong>Validate running pod(s)</strong></p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<p>Sample output:</p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-metrics-node-collector-2kzlp</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<h3 id="configure-kubernetes-rbac">Configure Kubernetes RBAC<a class="headerlink" href="#configure-kubernetes-rbac" title="Permanent link">#</a></h3>
<p><strong>Create <code>clusterrole</code> with read access to Kubernetes objects</strong></p>
<p>Since the receiver uses the Kubernetes API, it needs the correct permission to work correctly. For most use cases, you should give the service account running the Collector the following permissions via a ClusterRole.</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-metrics</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;events&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;namespaces&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;namespaces/status&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;nodes&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;nodes/spec&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;nodes/stats&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;nodes/proxy&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;pods&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;pods/status&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;replicationcontrollers&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;replicationcontrollers/status&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;resourcequotas&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;services&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;get&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;list&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;watch&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;apps&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;daemonsets&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;deployments&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;replicasets&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;statefulsets&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;get&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;list&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;watch&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;extensions&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;daemonsets&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;deployments&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;replicasets&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;get&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;list&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;watch&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;batch&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;jobs&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;cronjobs&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;get&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;list&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;watch&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;autoscaling&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;horizontalpodautoscalers&#39;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;get&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;list&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;watch&#39;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/rbac/otel-collector-k8s-clusterrole-metrics.yaml
</code></pre></div>
Sample output:</p>
<blockquote>
<p>clusterrole.rbac.authorization.k8s.io/otel-collector-k8s-clusterrole-metrics created</p>
</blockquote>
<p><strong>Create <code>clusterrolebinding</code> for OpenTelemetry Collector service account</strong></p>
<p><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-metrics-crb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-metrics-node-collector</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-metrics</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div>
Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/rbac/otel-collector-k8s-clusterrole-metrics-crb.yaml
</code></pre></div>
Sample output:</p>
<blockquote>
<p>clusterrolebinding.rbac.authorization.k8s.io/otel-collector-k8s-clusterrole-metrics-crb created</p>
</blockquote>
<h3 id="kubeletstats-receiver"><code>kubeletstats</code> receiver<a class="headerlink" href="#kubeletstats-receiver" title="Permanent link">#</a></h3>
<p><a href="https://opentelemetry.io/docs/kubernetes/collector/components/#kubeletstats-receiver" target="_blank">OpenTelemetry Documentation</a></p>
<p>By default, metrics will be collected for pods and nodes, but you can configure the receiver to collect container and volume metrics as well. The receiver also allows configuring how often the metrics are collected:</p>
<div class="highlight"><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">receivers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">kubeletstats</span><span class="p">:</span>
<span class="w">        </span><span class="nt">collection_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">        </span><span class="nt">auth_type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;serviceAccount&#39;</span>
<span class="w">        </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;${env:K8S_NODE_NAME}:10250&#39;</span>
<span class="w">        </span><span class="nt">insecure_skip_verify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">metric_groups</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
</code></pre></div>
<p><strong>Default Metrics:</strong> <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/kubeletstatsreceiver/documentation.md" target="_blank">OpenTelemetry Documentation</a></p>
<p><strong>note:</strong> for this lab, the Kind cluster does not have cluster metadata to collect.  These values will be spoofed for the purposes of this lab.</p>
<div class="highlight"><pre><span></span><code><span class="nt">resource/kind</span><span class="p">:</span>
<span class="w">  </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cluster.name</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dt-k8s-o11y-kind</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">insert</span>
</code></pre></div>
<p><strong>Query Node metrics in Dynatrace</strong></p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="n">node_cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="k">usage</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">name</span><span class="err">}</span>
</code></pre></div>
Result:</p>
<p><img alt="dql_kubeletstats_node_cpu" src="../img/metrics-dql_kubeletstats_node_cpu.png" /></p>
<h3 id="k8sattributes-processor">k8sattributes Processor<a class="headerlink" href="#k8sattributes-processor" title="Permanent link">#</a></h3>
<p>The Kubernetes Attributes Processor automatically discovers Kubernetes pods, extracts their metadata, and adds the extracted metadata to spans, metrics, and logs as resource attributes.</p>
<p>The Kubernetes Attributes Processor is one of the most important components for a collector running in Kubernetes. Any collector receiving application data should use it. Because it adds Kubernetes context to your telemetry, the Kubernetes Attributes Processor lets you correlate your application’s traces, metrics, and logs signals with your Kubernetes telemetry, such as pod metrics and traces.</p>
<p><strong>Add <code>k8sattributes</code> processor</strong></p>
<p><a href="https://opentelemetry.io/docs/kubernetes/collector/components/#kubernetes-attributes-processor" target="_blank">OpenTelemetry Documentation</a></p>
<p>The <code>k8sattributes</code> processor will query metadata from the cluster about the k8s objects.  The Collector will then marry this metadata to the telemetry.</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">k8sattributes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;serviceAccount&quot;</span>
<span class="w">  </span><span class="nt">passthrough</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_from_env_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBE_NODE_NAME</span>
<span class="w">  </span><span class="nt">extract</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.namespace.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.deployment.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.daemonset.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.job.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cronjob.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.replicaset.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.statefulset.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.uid</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.node.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.container.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container.id</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container.image.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container.image.tag</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.label.component</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.kubernetes.io/component</span>
<span class="w">        </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="w">    </span><span class="nt">pod_association</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource_attribute</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.uid</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource_attribute</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource_attribute</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.ip</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">connection</span>
</code></pre></div>
Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/metrics/otel-collector-metrics-node-crd-02.yaml
</code></pre></div>
Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-metrics-node configured</p>
</blockquote>
<p><strong>Validate running pod(s)</strong></p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<p>Sample output:</p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-metrics-node-collector-drk1p</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p><strong>Query Pod metrics in Dynatrace</strong></p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="n">pod_cpu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="k">usage</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">uid</span><span class="w"> </span><span class="err">}</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop-productcatalogservice&quot;</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="dql_kubeletstats_pod_cpu" src="../img/metrics-dql_kubeletstats_pod_cpu.png" /></p>
<h2 id="collector-for-cluster-metrics">Collector for Cluster Metrics<a class="headerlink" href="#collector-for-cluster-metrics" title="Permanent link">#</a></h2>
<p>The Kubernetes Cluster Receiver collects metrics and entity events about the cluster as a whole using the Kubernetes API server. Use this receiver to answer questions about pod phases, node conditions, and other cluster-wide questions.</p>
<h3 id="deploy-opentelemetry-collector_1">Deploy OpenTelemetry Collector<a class="headerlink" href="#deploy-opentelemetry-collector_1" title="Permanent link">#</a></h3>
<p><strong>Dynatrace Distro - Deployment (Gateway)</strong></p>
<p><a href="https://github.com/open-telemetry/opentelemetry-operator" target="_blank">OpenTelemetry Documentation</a></p>
<p>Since the receiver gathers telemetry for the cluster as a whole, only one instance of the receiver is needed across the cluster in order to collect all the data.  The Collector will be deployed as a Deployment (Gateway).</p>
<p><div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opentelemetry.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenTelemetryCollector</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-metrics-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-otelcol-dt-api-credentials</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ghcr.io/dynatrace/dynatrace-otel-collector/dynatrace-otel-collector:latest&quot;</span>
</code></pre></div>
Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/metrics/otel-collector-metrics-cluster-crd-01.yaml
</code></pre></div>
Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-metrics-cluster created</p>
</blockquote>
<p><strong>Validate running pod(s)</strong></p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<p>Sample output:</p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-metrics-cluster-collector-7bd8dc4995-6sgs2</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<h3 id="k8s_cluster-receiver"><code>k8s_cluster</code> receiver<a class="headerlink" href="#k8s_cluster-receiver" title="Permanent link">#</a></h3>
<p><a href="https://opentelemetry.io/docs/kubernetes/collector/components/#kubernetes-cluster-receiver" target="_blank">OpenTelemetry Documentation</a></p>
<p><div class="highlight"><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">receivers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">k8s_cluster</span><span class="p">:</span>
<span class="w">        </span><span class="nt">collection_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>
<span class="w">        </span><span class="nt">node_conditions_to_report</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;Ready&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;MemoryPressure&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;DiskPressure&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">allocatable_types_to_report</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&quot;cpu&quot;</span><span class="p p-Indicator">,</span><span class="s">&quot;memory&quot;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">metadata_collection_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
</code></pre></div>
<strong>Default Metrics:</strong> <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/k8sclusterreceiver/documentation.md" target="_blank">OpenTelemetry Documentation</a></p>
<p><strong>Query Deployment metrics in Dynatrace</strong></p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="n">pods_avail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">available</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="err">}</span>
</code></pre></div>
Result:</p>
<p><img alt="dql_k8scluster_pod_avail" src="../img/metrics-dql_k8scluster_pod_avail.png" /></p>
<h2 id="export-application-metrics">Export Application Metrics<a class="headerlink" href="#export-application-metrics" title="Permanent link">#</a></h2>
<p>The <code>astronomy-shop</code> demo application has the OpenTelemetry agents and SDKs already instrumented.  These agents and SDKs are generating metrics (traces and logs too) that are being exported to a Collector running within the <code>astronomy-shop</code> namespace bundled into the application deployment.  We want these metrics to be shipped to Dynatrace as well.</p>
<h3 id="otlp-receiver"><code>otlp</code> receiver<a class="headerlink" href="#otlp-receiver" title="Permanent link">#</a></h3>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver" target="_blank">OpenTelemetry Documentation</a></p>
<p>Adding the <code>otlp</code> receiver allows us to receive telemetry from otel exporters, such as agents and other collectors.</p>
<div class="highlight"><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">receivers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">otlp</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocols</span><span class="p">:</span>
<span class="w">          </span><span class="nt">grpc</span><span class="p">:</span>
<span class="w">            </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:4317</span>
<span class="w">          </span><span class="nt">http</span><span class="p">:</span>
<span class="w">            </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:4318</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">        </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">          </span><span class="nt">receivers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlp</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">processors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">batch</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">exporters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlphttp/dynatrace</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p><strong>Export OpenTelemetry data from <code>astronomy-shop</code> to OpenTelemetry Collector - Dynatrace Distro</strong></p>
<p><strong>Customize astronomy-shop helm values</strong></p>
<p>OpenTelemetry data created by agents and SDKs should include <code>service.name</code> and <code>service.namespace</code> attributes.  We will make the <code>service.namespace</code> unique to our deployment using our <code>NAME</code> environment variable declared earlier, using a <code>sed</code> command on the Helm chart's <code>values.yaml</code> file.</p>
<div class="highlight"><pre><span></span><code><span class="nt">default</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># List of environment variables applied to all components</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_SERVICE_NAME</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">        </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">          </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;metadata.labels[&#39;app.kubernetes.io/component&#39;]&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_COLLECTOR_NAME</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">&quot;otel-demo.name&quot;</span><span class="nv"> </span><span class="s">.</span><span class="nv"> </span><span class="s">}}-otelcol&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cumulative</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_RESOURCE_ATTRIBUTES</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;service.name=$(OTEL_SERVICE_NAME),service.namespace=NAME_TO_REPLACE,service.version={{</span><span class="nv"> </span><span class="s">.Chart.AppVersion</span><span class="nv"> </span><span class="s">}}&#39;</span>
</code></pre></div>
<blockquote>
<p>service.namespace=NAME_TO_REPLACE\
service.namespace=INITIALS-k8s-otel-o11y</p>
</blockquote>
<p>Command:
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span><span class="s2">&quot;s,NAME_TO_REPLACE,</span><span class="nv">$NAME</span><span class="s2">,&quot;</span><span class="w"> </span>astronomy-shop/collector-values.yaml<span class="w"> </span>&gt;<span class="w"> </span>astronomy-shop/sed/collector-values.yaml
</code></pre></div></p>
<p><strong>Update <code>astronomy-shop</code> OpenTelemetry Collector export endpoint via helm</strong></p>
<p>Our <code>collector-values.yaml</code> contains new configurations for the application so that the <code>astronomy-shop</code> Collector includes exporters that ship to the Collectors deployed in the <code>dynatrace</code> namespace.</p>
<div class="highlight"><pre><span></span><code><span class="nt">exporters</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Dynatrace OTel Collectors</span>
<span class="w">  </span><span class="nt">otlphttp/dttraces</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://dynatrace-traces-collector.dynatrace.svc.cluster.local:4318</span>
<span class="w">  </span><span class="nt">otlphttp/dtlogs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://dynatrace-logs-collector.dynatrace.svc.cluster.local:4318</span>
<span class="w">  </span><span class="nt">otlphttp/dtmetrics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://dynatrace-metrics-cluster-collector.dynatrace.svc.cluster.local:4318</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>upgrade<span class="w"> </span>astronomy-shop<span class="w"> </span>open-telemetry/opentelemetry-demo<span class="w"> </span>--values<span class="w"> </span>astronomy-shop/sed/collector-values.yaml<span class="w"> </span>--namespace<span class="w"> </span>astronomy-shop<span class="w"> </span>--version<span class="w"> </span><span class="s2">&quot;0.31.0&quot;</span>
</code></pre></div>
Sample output:</p>
<blockquote>
<p>NAME: astronomy-shop\
LAST DEPLOYED: Thu Jun 27 20:58:38 2024\
NAMESPACE: astronomy-shop\
STATUS: deployed\
REVISION: 2</p>
</blockquote>
<p><strong>Query <code>astronomy-shop</code> metrics in Dynatrace</strong></p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="n">jvm_mem_used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">jvm</span><span class="p">.</span><span class="n">memory</span><span class="p">.</span><span class="n">used</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="err">}</span>
</code></pre></div>
Result:</p>
<p><img alt="dql_sdk_jvm_mem" src="../img/metrics-dql_sdk_jvm_mem.png" /></p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">kafka</span><span class="p">.</span><span class="n">consumer</span><span class="p">.</span><span class="n">request_rate</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">filter</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="err">}</span>
</code></pre></div>
Result:</p>
<p><img alt="dql_sdk_kafka_request_rate" src="../img/metrics-dql_sdk_kafka_request_rate.png" /></p>
<p><strong>Browse available metrics in Dynatrace</strong></p>
<!-- TODO: Update to Grail query in Notebook, remove classic screen -->

<p>You can browse all available metrics from OpenTelemetry sources in the Metrics Browser.  Filter on <code>Dimension:otel.scope.name</code> to find relevant metrics.</p>
<p><a href="https://docs.dynatrace.com/docs/observe-and-explore/dashboards-classic/metrics-browser" target="_blank">Dynatrace Documentation</a></p>
<p><img alt="dt_otel_scope_metrics" src="../img/metrics-dt_otel_scope_metrics.png" /></p>
<h2 id="wrap-up">Wrap Up<a class="headerlink" href="#wrap-up" title="Permanent link">#</a></h2>
<h3 id="what-you-learned-today">What You Learned Today<a class="headerlink" href="#what-you-learned-today" title="Permanent link">#</a></h3>
<p>By completing this lab, you've successfully deployed the OpenTelemetry Collector to collect metrics, enrich metric attributes for better context, and ship those metrics to Dynatrace for analysis.</p>
<ul>
<li>One Dynatrace Distro OpenTelemetry Collector was deployed as a DaemonSet, behaving as an Agent running on each Node<ul>
<li>The <code>kubeletstats</code> receiver scrapes metrics from the local kubelet on the Node</li>
<li>The <code>k8sattributes</code> processor enriches the metrics with Kubernetes attributes that may be missing without it</li>
</ul>
</li>
<li>A second Dynatrace Distro OpenTelemetry Collector was deployed as a Deployment, behaving as a Gateway<ul>
<li>The <code>k8s_cluster</code> receiver queries the Kubernetes cluster API to retrieve metrics</li>
<li>The <code>k8sattributes</code> processor enriches the metrics with Kubernetes attributes that may be missing without it</li>
<li>The <code>otlp</code> receiver receives signals that are exported from agents, SDKs, and other Collectors</li>
</ul>
</li>
<li>Metrics produced by the OpenTelemetry SDKs and Agents are exported to the <code>otlp</code> receiver</li>
<li>Dynatrace DQL (via Notebooks) allows you to perform powerful queries and analysis of the metric data</li>
</ul>
<h2 id="continue">Continue<a class="headerlink" href="#continue" title="Permanent link">#</a></h2>
<p>In the next section, we'll integrate and apply what we have learned in the OpenTelemetry Capstone.</p>
<div class="grid cards">
<ul>
<li><a href="../7-opentelemetry-capstone/">Continue to OpenTelemetry Capstone<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>