{
    "version": 20,
    "variables": [],
    "tiles": {
        "0": {
            "title": "Service Response Time",
            "type": "data",
            "query": "timeseries sum(dt.service.request.response_time), by: {dt.entity.service}\n| lookup [ fetch dt.entity.service\n            | filter serviceType == \"UNIFIED\" and serviceDetectionAttributes[`k8s.namespace.name`] == \"astronomy-shop\"\n            | filterOut isNotNull(serviceDetectionAttributes[`istio.canonical_service`])\n            | fields id, entity.name, k8s.namespace.name = serviceDetectionAttributes[`k8s.namespace.name`] ], sourceField:dt.entity.service, lookupField: id, prefix: \"service.\"\n| filterOut isNull(service.id)\n| fieldsRemove service.id, service.k8s.namespace.name",
            "visualization": "lineChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "leftYAxisSettings": {
                        "label": "Duration/Latency"
                    },
                    "fieldMapping": {
                        "leftAxisValues": [
                            "sum(dt.service.request.response_time)"
                        ],
                        "timestamp": "timeframe"
                    },
                    "gapPolicy": "connect"
                },
                "thresholds": [],
                "dataMapping": {
                    "displayedFields": [
                        "service.entity.name"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "1": {
            "title": "Service Throughput",
            "type": "data",
            "query": "timeseries sum(dt.service.request.count), by: {dt.entity.service}\n| lookup [ fetch dt.entity.service\n            | filter serviceType == \"UNIFIED\" and serviceDetectionAttributes[`k8s.namespace.name`] == \"astronomy-shop\"\n            | filterOut isNotNull(serviceDetectionAttributes[`istio.canonical_service`])\n            | fields id, entity.name, k8s.namespace.name = serviceDetectionAttributes[`k8s.namespace.name`] ], sourceField:dt.entity.service, lookupField: id, prefix: \"service.\"\n| filterOut isNull(service.id)\n| fieldsRemove service.id, service.k8s.namespace.name",
            "visualization": "barChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "leftYAxisSettings": {
                        "label": "Requests/Spans"
                    },
                    "fieldMapping": {
                        "leftAxisValues": [
                            "sum(dt.service.request.count)"
                        ],
                        "timestamp": "timeframe"
                    }
                },
                "thresholds": [],
                "dataMapping": {
                    "displayedFields": [
                        "service.entity.name"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "3": {
            "title": "Service Failure Rate",
            "type": "data",
            "query": "timeseries {\n  request_count = sum(dt.service.request.count),\n  failure_count = sum(dt.service.request.failure_count)\n }, by: {dt.entity.service}\n| fieldsAdd failure_rate = (failure_count[] / request_count[]) * 100\n| fieldsRemove request_count, failure_count\n| lookup [ fetch dt.entity.service\n            | filter serviceType == \"UNIFIED\" and serviceDetectionAttributes[`k8s.namespace.name`] == \"astronomy-shop\"\n            | filterOut isNotNull(serviceDetectionAttributes[`istio.canonical_service`])\n            | fields id, entity.name, k8s.namespace.name = serviceDetectionAttributes[`k8s.namespace.name`] ], sourceField:dt.entity.service, lookupField: id, prefix: \"service.\"\n| filterOut isNull(service.id)\n| fieldsRemove service.id, service.k8s.namespace.name",
            "visualization": "areaChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "leftYAxisSettings": {
                        "label": "Failure Rate",
                        "min": {
                            "mode": "custom",
                            "value": 0
                        },
                        "max": {
                            "mode": "custom",
                            "value": 105
                        }
                    },
                    "fieldMapping": {
                        "leftAxisValues": [
                            "failure_rate"
                        ],
                        "timestamp": "timeframe"
                    },
                    "gapPolicy": "connect"
                },
                "thresholds": [
                    {
                        "id": 1,
                        "field": "",
                        "title": "Failure Rate",
                        "isEnabled": true,
                        "rules": [
                            {
                                "id": 0,
                                "color": {
                                    "Default": "var(--dt-colors-charts-categorical-color-09-default, #649438)"
                                },
                                "comparator": "≥",
                                "label": ""
                            },
                            {
                                "id": 1,
                                "color": {
                                    "Default": "var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"
                                },
                                "comparator": "≥",
                                "label": "",
                                "value": 50
                            },
                            {
                                "id": 2,
                                "color": {
                                    "Default": "var(--dt-colors-charts-categorical-color-12-default, #cd3741)"
                                },
                                "comparator": "≥",
                                "label": "",
                                "value": 80
                            }
                        ]
                    }
                ],
                "unitsOverrides": [
                    {
                        "identifier": "failure_rate",
                        "unitCategory": "percentage",
                        "baseUnit": "percent",
                        "displayUnit": null,
                        "decimals": 2,
                        "suffix": "",
                        "delimiter": false,
                        "added": 1718043592519
                    }
                ],
                "dataMapping": {
                    "displayedFields": [
                        "service.entity.name"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "4": {
            "title": "k8s Cluster Resource Utilization",
            "type": "data",
            "query": "timeseries {cpu = avg(k8s.node.cpu.usage), mem = avg(k8s.node.memory.usage)}, by: {k8s.cluster.name, k8s.node.name}\n",
            "visualization": "lineChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "colorPalette": "blue-steel",
                    "fieldMapping": {
                        "leftAxisValues": [
                            "cpu",
                            "mem"
                        ],
                        "timestamp": "timeframe"
                    },
                    "gapPolicy": "connect"
                },
                "thresholds": [],
                "dataMapping": {
                    "displayedFields": [
                        "k8s.cluster.name",
                        "k8s.node.name",
                        "cpu",
                        "mem"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "6": {
            "title": "k8s Deployment Pod Availability",
            "type": "data",
            "query": "timeseries {desired = avg(k8s.deployment.desired), avail = avg(k8s.deployment.available)}, by: {k8s.cluster.name, k8s.deployment.name, k8s.namespace.name}\n| filter k8s.namespace.name == \"astronomy-shop\"\n| fieldsAdd pct = (avail[]/desired[])*100\n| summarize pct = takeLast(arrayAvg(pct)), by: {k8s.deployment.name}\n",
            "visualization": "categoricalBarChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "categoryOverrides": {},
                    "categoricalBarChartSettings": {
                        "categoryAxis": "k8s.deployment.name",
                        "valueAxis": "pct",
                        "valueAxisLabel": "Percent",
                        "min": 0,
                        "max": 100,
                        "layout": "vertical"
                    }
                },
                "thresholds": []
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "7": {
            "title": "astronomy-shop Payment Transactions",
            "type": "data",
            "query": "timeseries payments = sum(app.payment.transactions)\n| summarize payments = sum(arraySum(payments))",
            "visualization": "singleValue",
            "visualizationSettings": {
                "singleValue": {
                    "recordField": "payments",
                    "prefixIcon": "",
                    "colorThresholdTarget": "background",
                    "trend": {
                        "isVisible": false
                    }
                },
                "thresholds": [
                    {
                        "id": 1,
                        "field": "payments",
                        "title": "",
                        "isEnabled": true,
                        "rules": [
                            {
                                "id": 0,
                                "color": {
                                    "Default": "var(--dt-colors-charts-status-ideal-default, #2f6863)"
                                },
                                "comparator": "≥",
                                "label": "",
                                "value": 5
                            },
                            {
                                "id": 1,
                                "color": {
                                    "Default": "var(--dt-colors-charts-status-warning-default, #eca440)"
                                },
                                "comparator": "≥",
                                "label": "",
                                "value": 1
                            },
                            {
                                "id": 2,
                                "color": {
                                    "Default": "var(--dt-colors-charts-status-critical-default, #c4233b)"
                                },
                                "comparator": "≥",
                                "label": "",
                                "value": 0
                            }
                        ]
                    }
                ]
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "8": {
            "title": "astronomy-shop Orders Placed/Paid",
            "type": "data",
            "query": "fetch logs\n| filter k8s.namespace.name == \"astronomy-shop\" and k8s.deployment.name == \"astronomy-shop-checkoutservice\"\n| makeTimeseries {ordersPlaced = countIf(contains(content,\"[PlaceOrder]\")),ordersPaid = countIf(contains(content,\"payment went through\"))}, interval: 5m\n",
            "visualization": "lineChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "colorPalette": "purple-rain",
                    "fieldMapping": {
                        "leftAxisValues": [
                            "ordersPlaced",
                            "ordersPaid"
                        ],
                        "timestamp": "timeframe"
                    },
                    "gapPolicy": "connect"
                },
                "thresholds": [],
                "dataMapping": {
                    "displayedFields": [
                        "ordersPlaced",
                        "ordersPaid"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "9": {
            "title": "astronomy-shop Frontend HttpCheck",
            "type": "data",
            "query": "timeseries status = avg(httpcheck.status), by: {http.url, http.status_class}",
            "visualization": "lineChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "leftYAxisSettings": {
                        "label": "status code results",
                        "max": {
                            "mode": "custom",
                            "value": 1.5
                        }
                    },
                    "fieldMapping": {
                        "leftAxisValues": [
                            "status"
                        ],
                        "timestamp": "timeframe"
                    },
                    "gapPolicy": "connect"
                },
                "thresholds": [],
                "dataMapping": {
                    "displayedFields": [
                        "http.url",
                        "http.status_class"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        },
        "10": {
            "title": "astronomy-shop Recommendations Given",
            "type": "data",
            "query": "fetch logs\n| filter k8s.namespace.name == \"astronomy-shop\" and isNotNull(service.name)\n| filter service.name == \"recommendationservice\"\n| makeTimeseries recommendations = countIf(contains(content,\"Receive ListRecommendations\")), interval: 5m",
            "visualization": "barChart",
            "visualizationSettings": {
                "chartSettings": {
                    "legend": {
                        "hidden": true
                    },
                    "fieldMapping": {
                        "leftAxisValues": [
                            "recommendations"
                        ],
                        "timestamp": "timeframe"
                    }
                },
                "thresholds": [],
                "dataMapping": {
                    "displayedFields": [
                        "recommendations"
                    ]
                }
            },
            "querySettings": {
                "maxResultRecords": 1000,
                "defaultScanLimitGbytes": 500,
                "maxResultMegaBytes": 100,
                "defaultSamplingRatio": 10,
                "enableSampling": false
            },
            "davis": {
                "enabled": false,
                "davisVisualization": {
                    "isAvailable": true
                }
            }
        }
    },
    "layouts": {
        "0": {
            "x": 0,
            "y": 6,
            "w": 7,
            "h": 6
        },
        "1": {
            "x": 0,
            "y": 0,
            "w": 7,
            "h": 6
        },
        "3": {
            "x": 0,
            "y": 12,
            "w": 7,
            "h": 6
        },
        "4": {
            "x": 7,
            "y": 0,
            "w": 7,
            "h": 6
        },
        "6": {
            "x": 7,
            "y": 6,
            "w": 7,
            "h": 6
        },
        "7": {
            "x": 14,
            "y": 6,
            "w": 7,
            "h": 6
        },
        "8": {
            "x": 14,
            "y": 0,
            "w": 7,
            "h": 6
        },
        "9": {
            "x": 7,
            "y": 12,
            "w": 7,
            "h": 6
        },
        "10": {
            "x": 14,
            "y": 12,
            "w": 7,
            "h": 6
        }
    },
    "importedWithCode": false,
    "settings": {}
}